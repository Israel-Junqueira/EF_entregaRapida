@using EntregaRapida.Models
@using EntregaRapida.Models.Enum
@model List<Pedido> 

<script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <a class="nav-link btn btn-link py-0" asp-controller="" asp-action="" style="color:black">Historico de Entregas</a>
  <a class="nav-link btn btn-link py-0" asp-controller="" asp-action="" style="color:black">Meus Dados</a>




@section script{
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var connection = new signalR.HubConnectionBuilder().withUrl("/entregadorHub").build();

        connection.on("ReceberPedido", function (pedido) {
            var container = document.getElementById("pedidos-container");

            var card = document.createElement("div");
            card.classList.add("card", "text-center", "mt-4");

            var cardHeader = document.createElement("div");
            cardHeader.classList.add("card-header");
            cardHeader.textContent = "Pedido ID: " + pedido.pedidoId;

            var cardBody = document.createElement("div");
            cardBody.classList.add("card-body");

            var cardTitle = document.createElement("h5");
            cardTitle.classList.add("card-title");
            cardTitle.textContent = pedido.descricao;

            var cardText = document.createElement("p");
            cardText.classList.add("card-text");
            cardText.textContent = "Endereço de Destino: " + pedido.enderecoDestino;

            var entregadorId = document.createElement("p");
            entregadorId.classList.add("card-text");
            entregadorId.textContent = "Entregador ID: " + pedido.EntregadorId;

            var lojistaId = document.createElement("p");
            lojistaId.classList.add("card-text");
            lojistaId.textContent = "Lojista ID: " + pedido.LojistaId;

            var btnEntregar = document.createElement("a");
            btnEntregar.href = "#";
            btnEntregar.classList.add("btn", "btn-primary");
            btnEntregar.textContent = "Entregar";

            cardBody.appendChild(cardTitle);
            cardBody.appendChild(cardText);
            cardBody.appendChild(entregadorId);
            cardBody.appendChild(lojistaId);
            cardBody.appendChild(btnEntregar);

            var cardFooter = document.createElement("div");
            cardFooter.classList.add("card-footer", "text-muted");
            cardFooter.textContent = "Data: " + pedido.date;

            card.appendChild(cardHeader);
            card.appendChild(cardBody);
            card.appendChild(cardFooter);

            container.appendChild(card);
        });

        connection.on("ReceberPedidosPendentes", function (pedidosPendentes) {
            var container = document.getElementById("pedidos-container");

            container.innerHTML = ""; // Limpar o conteúdo anterior

            pedidosPendentes.forEach(function (pedido) {
                var card = document.createElement("div");
                card.classList.add("card", "text-center", "mt-4");

                var cardHeader = document.createElement("div");
                cardHeader.classList.add("card-header");
                cardHeader.textContent = "Pedido ID: " + pedido.pedidoId;

                var cardBody = document.createElement("div");
                cardBody.classList.add("card-body");

                var cardTitle = document.createElement("h5");
                cardTitle.classList.add("card-title");
                cardTitle.textContent = pedido.descricao;

                var cardText = document.createElement("p");
                cardText.classList.add("card-text");
                cardText.textContent = "Endereço de Destino: " + pedido.enderecoDestino;

                var entregadorId = document.createElement("p");
                entregadorId.classList.add("card-text");
                entregadorId.textContent = "Entregador ID: " + pedido.EntregadorId;

                var lojistaId = document.createElement("p");
                lojistaId.classList.add("card-text");
                lojistaId.textContent = "Lojista ID: " + pedido.LojistaId;

                var btnEntregar = document.createElement("a");
                btnEntregar.href = "#";
                btnEntregar.classList.add("btn", "btn-primary");
                btnEntregar.textContent = "Entregar";

                cardBody.appendChild(cardTitle);
                cardBody.appendChild(cardText);
                cardBody.appendChild(entregadorId);
                cardBody.appendChild(lojistaId);
                cardBody.appendChild(btnEntregar);

                var cardFooter = document.createElement("div");
                cardFooter.classList.add("card-footer", "text-muted");
                cardFooter.textContent = "Data: " + pedido.date;

                card.appendChild(cardHeader);
                card.appendChild(cardBody);
                card.appendChild(cardFooter);

                container.appendChild(card);

                 window.scrollTo(0, document.body.scrollHeight);
            });
        });

        connection.start().then(function () {
            connection.invoke("ObterPedidosPendentes");
            
        }).catch(function (err) {
            console.error(err.toString());
        });
    });
</script>


}